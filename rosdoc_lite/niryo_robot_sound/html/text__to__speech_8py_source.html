<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>niryo_robot_sound: text_to_speech.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_1e24a089b3ee1783fa12a0549e99c5df.html">niryo_robot_sound</a></li><li class="navelem"><a class="el" href="dir_2a8fad65cb9ce5a3d7023e8177c1bb6c.html">src</a></li><li class="navelem"><a class="el" href="dir_7f3cacfcfbf1905a4c07195fa0f1b3d6.html">niryo_robot_sound</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">text_to_speech.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="text__to__speech_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacesrc_1_1niryo__robot__sound_1_1text__to__speech.html">    1</a></span>&#160;<span class="comment"># Lib</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">from</span> tempfile <span class="keyword">import</span> NamedTemporaryFile</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> rospy</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">import</span> os</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span> gtts <span class="keyword">import</span> gTTS, gTTSError</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">from</span> niryo_robot_sound.srv <span class="keyword">import</span> TextToSpeech, TextToSpeechRequest</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html">   11</a></span>&#160;<span class="keyword">class </span><a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html">NiryoTextToSpeech</a>(object):</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a5645e5e0010d7a883e4ee8b0d0a3982d">   13</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a5645e5e0010d7a883e4ee8b0d0a3982d">__init__</a>(self, sound_manager, sound_data_base):</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        <span class="comment"># - Init</span></div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a57b64c2d7195336595b5695736b8780e">   15</a></span>&#160;        self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a57b64c2d7195336595b5695736b8780e">__sound_database</a> = sound_data_base</div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#abd42e7b8b485e3955c43c63c260b6077">   16</a></span>&#160;        self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#abd42e7b8b485e3955c43c63c260b6077">__sound_manager</a> = sound_manager</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#ad6a985a26e5534fe8dec9428f69d8c7b">   18</a></span>&#160;        self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#ad6a985a26e5534fe8dec9428f69d8c7b">__languages</a> = {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            TextToSpeechRequest.ENGLISH: <span class="stringliteral">&#39;en&#39;</span>,</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            TextToSpeechRequest.FRENCH: <span class="stringliteral">&#39;fr&#39;</span>,</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            TextToSpeechRequest.SPANISH: <span class="stringliteral">&#39;es&#39;</span>,</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            TextToSpeechRequest.MANDARIN: <span class="stringliteral">&#39;zh-CN&#39;</span>,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;            TextToSpeechRequest.PORTUGUESE: <span class="stringliteral">&#39;pt&#39;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        }</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="comment"># - Services</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        rospy.Service(<span class="stringliteral">&#39;~text_to_speech&#39;</span>, TextToSpeech, self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a925b75baf029e849e124990350e997fc">__callback_text_to_speech</a>)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment"># - Callbacks</span></div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a925b75baf029e849e124990350e997fc">   30</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a925b75baf029e849e124990350e997fc">__callback_text_to_speech</a>(self, req):</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="keywordflow">if</span> len(req.text) &gt; 100:</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span>, <span class="stringliteral">&quot;Text too long, length limited to 100 characters&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keywordflow">elif</span> req.language <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#ad6a985a26e5534fe8dec9428f69d8c7b">__languages</a>:</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span>, <span class="stringliteral">&quot;Unknown language&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#aaea9f255619698c07cee750bfc647937">say</a>(req.text, self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#ad6a985a26e5534fe8dec9428f69d8c7b">__languages</a>[req.language])</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keywordflow">except</span> RuntimeError <span class="keyword">as</span> e:</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span>, str(e)</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span>, <span class="stringliteral">&quot;Success&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#aaea9f255619698c07cee750bfc647937">   42</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#aaea9f255619698c07cee750bfc647937">say</a>(self, text, language):</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        tts = gTTS(text, lang=language)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keyword">with</span> NamedTemporaryFile(dir=self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a57b64c2d7195336595b5695736b8780e">__sound_database</a>.user_sound_directory_path, suffix=<span class="stringliteral">&#39;.mp3&#39;</span>) <span class="keyword">as</span> tts_file:</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                tts.write_to_fp(tts_file)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                tts_file.flush()</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            <span class="keywordflow">except</span> gTTSError <span class="keyword">as</span> e:</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                <span class="keywordflow">raise</span> RuntimeError(f<span class="stringliteral">&#39;gTTS call failed: {e}&#39;</span>) <span class="keyword">from</span> e</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a57b64c2d7195336595b5695736b8780e">__sound_database</a>.refresh_user_sounds()</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#abd42e7b8b485e3955c43c63c260b6077">__sound_manager</a>.play_user_sound(os.path.basename(tts_file.name))</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        self.<a class="code" href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a57b64c2d7195336595b5695736b8780e">__sound_database</a>.refresh_user_sounds()</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech</a></div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00011">text_to_speech.py:11</a></div></div>
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html_abd42e7b8b485e3955c43c63c260b6077"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#abd42e7b8b485e3955c43c63c260b6077">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech.__sound_manager</a></div><div class="ttdeci">__sound_manager</div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00016">text_to_speech.py:16</a></div></div>
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html_a925b75baf029e849e124990350e997fc"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a925b75baf029e849e124990350e997fc">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech.__callback_text_to_speech</a></div><div class="ttdeci">def __callback_text_to_speech(self, req)</div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00030">text_to_speech.py:30</a></div></div>
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html_ad6a985a26e5534fe8dec9428f69d8c7b"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#ad6a985a26e5534fe8dec9428f69d8c7b">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech.__languages</a></div><div class="ttdeci">__languages</div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00018">text_to_speech.py:18</a></div></div>
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html_aaea9f255619698c07cee750bfc647937"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#aaea9f255619698c07cee750bfc647937">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech.say</a></div><div class="ttdeci">def say(self, text, language)</div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00042">text_to_speech.py:42</a></div></div>
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html_a5645e5e0010d7a883e4ee8b0d0a3982d"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a5645e5e0010d7a883e4ee8b0d0a3982d">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech.__init__</a></div><div class="ttdeci">def __init__(self, sound_manager, sound_data_base)</div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00013">text_to_speech.py:13</a></div></div>
<div class="ttc" id="aclasssrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech_html_a57b64c2d7195336595b5695736b8780e"><div class="ttname"><a href="classsrc_1_1niryo__robot__sound_1_1text__to__speech_1_1NiryoTextToSpeech.html#a57b64c2d7195336595b5695736b8780e">src.niryo_robot_sound.text_to_speech.NiryoTextToSpeech.__sound_database</a></div><div class="ttdeci">__sound_database</div><div class="ttdef"><b>Definition:</b> <a href="text__to__speech_8py_source.html#l00015">text_to_speech.py:15</a></div></div>

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/niryo_robot_sound">niryo_robot_sound</a><br />
Author(s): Nicolas Guy <n.guy@niryo.com></br />
<small>autogenerated on Wed May 21 2025 08:30:04</small>
</div>
</body>
</html>
